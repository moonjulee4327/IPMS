<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ipms.proj.dashboard.mapper.DashBoardMapper">
	
	<select id="selectTask" parameterType="hashmap" resultType="com.ipms.proj.task.vo.TaskVO">
		SELECT
		    task_id,
		    proj_id,
		    (SELECT m.mem_name FROM mem m WHERE t.mem_code = m.mem_code) as memCode,
		    high_task_id,
		    task_title,
		    task_strt_date,
		    task_end_date,
		    task_stus_code,
		    task_pgres,
		    low_rgst_seq,
		    aprov_whth,
		    task_repre,
		    delete_yn,
		    refer_cts,
		    work_update_num
		FROM
    		task t
		WHERE
			proj_id = #{projId}
		AND
			delete_yn ='n'
	</select>
	
	<select id="selectIssue" parameterType="hashmap" resultType="com.ipms.proj.issue.vo.IssueVO">
		 SELECT
		    issue_id,
		    task_id,
		    issue_title,
		    issue_rgst_date,
		    issue_stus_code,
		    itgrn_attach_file_num,
		    delete_yn,
		    (SELECT m.mem_name FROM mem m WHERE i.writer = m.mem_code) as writer
		FROM
		    issue i
		WHERE
			proj_id = #{projId}
		AND
			delete_yn ='n'
	</select>
	
	<select id="selectProjNotice" parameterType="hashmap" resultType="com.ipms.proj.noticeboard.vo.NoticeBoardVO">
		SELECT
		    p.proj_nt_num,
		    p.proj_id,
		    (SELECT m.mem_name FROM mem m WHERE p.MEM_CODE = m.mem_code) as memCode,
		    p.proj_nt_title,
		    p.itgrn_attach_file_num,
		    p.delete_yn,
		    p.proj_nt_write_date
		FROM
		    proj_nt p
		WHERE
			p.proj_id = #{projId}
		AND
			p.delete_yn ='n'
	</select>
	
	<select id="selectProjBoard" parameterType="hashmap" resultType="com.ipms.proj.freeboard.vo.FreeboardVO">
		SELECT
		    proj_bd_id,
		    (SELECT m.mem_name FROM mem m WHERE p.writer = mem_code) as writer,
		    proj_id,
		    proj_bd_title,
		    proj_bd_write_date,
		    itgrn_attach_file_num,
		    delete_yn
		FROM
		    proj_bd p
		WHERE
			proj_id = #{projId}
		AND
			p.delete_yn ='n'
	</select>
	
	<select id="selectPgres" parameterType="hashmap" resultType="map">
		SELECT 
		    COUNT(TASK_ID) as task,
		    SUM(TASK_PGRES) as pgres
		FROM 
			TASK
		WHERE 
			PROJ_ID = #{projId}
	</select>
	
	<select id="selectErd" parameterType="hashmap" resultType="com.ipms.proj.erd.vo.ErdVO">
	SELECT
	    erd_num,
	    proj_id,
	    writer,
	    erd_title,
	    delete_yn
	FROM
	    erd_proj
	WHERE
		proj_id = #{projId}
	AND
		delete_yn ='n'
	</select>
	
	<select id="selectWiki" parameterType="hashmap" resultType="com.ipms.proj.wiki.vo.WikiVO">
	SELECT
	    wiki_id,
	    proj_id,
	     (SELECT mem_name FROM mem WHERE w.MEM_CODE = mem_code) as memCode,
	    high_wiki_id,
	    wiki_title,
	    wiki_write_date,
	    delete_yn
	FROM
	    wiki w
	WHERE
		proj_id = #{projId}
	AND
		delete_yn ='n'
	</select>
	
	<select id="selectProj" parameterType="hashmap" resultType="com.ipms.main.newProject.vo.ProjVO">
		SELECT
		    proj_id,
		    proj_name,
		    proj_strt_date,
		    proj_end_date,
		    proj_opn_whth,
		    proj_creatn_date,
		    proj_img_route,
		    delete_whth
		FROM
		    proj
		WHERE 
		    proj_id = #{projId}
	</select>
</mapper>