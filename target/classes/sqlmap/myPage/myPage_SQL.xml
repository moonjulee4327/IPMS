<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ipms.main.mypage.mapper.MyPageMapper">
    <!-- 신청한 회원 조회  com.ipms.main.mypage.mapper.MyPageMapper.memberWhoApplied-->
    <select id="memberWhoApplied" parameterType="com.ipms.main.newProject.vo.ProjMemVO"
            resultType="com.ipms.main.newProject.vo.ProjMemVO">
        <![CDATA[
        SELECT A.MEM_CODE, A.PROJ_ID, A.TEAM_ID
        FROM PROJ_MEM A
        WHERE A.MEM_CODE <> #{memCode}
          AND A.prtpt_aprov_code = 'N'
          AND A.PROJ_ID IN
              (SELECT B.PROJ_ID FROM MEMBER_AUTH B WHERE B.MEM_CODE = #{memCode} AND B.MEM_AUTH = 'ROLE_PROJECT_LEADER')
        ]]>
    </select>

    <!-- 신청한 프로젝트 com.ipms.main.mypage.mapper.MyPageMapper.projectsApplied-->
    <select id="projectsApplied" parameterType="com.ipms.main.newProject.vo.ProjMemVO"
            resultType="com.ipms.main.newProject.vo.ProjMemVO">
        SELECT A.MEM_CODE, A.PROJ_ID, A.TEAM_ID
        FROM PROJ_MEM A
        WHERE A.MEM_CODE = #{memCode}
          AND A.prtpt_aprov_code = 'N'
    </select>


    <select id="getMemCode" parameterType="string" resultType="string">
        select mem_code
        from mem
        where mem_email = #{memEmail}
    </select>

    <update id="approvalJoiningProject" parameterType="com.ipms.main.newProject.vo.ProjMemVO">
        UPDATE proj_mem
        SET prtpt_aprov_code = 'Y'
        WHERE mem_code = #{memCode}
          AND proj_id = #{projId}
          AND prtpt_aprov_code = 'N'
    </update>

    <update id="companionProject" parameterType="com.ipms.main.newProject.vo.ProjMemVO">
        UPDATE proj_mem
        SET prtpt_aprov_code = 'N',
            REFER_CTS='반려'
        WHERE mem_code = #{memCode}
          AND proj_id = #{projId}
          AND prtpt_aprov_code = 'Y'
          AND REFER_CTS = '0'
    </update>


    <select id="goingProjects" parameterType="com.ipms.main.newProject.vo.ProjMemVO"
            resultType="com.ipms.main.newProject.vo.ProjMemVO">
        SELECT TEAM_ID
             , (SELECT M.MEM_NAME
                FROM MEM M
                WHERE M.MEM_CODE IN (SELECT A.MEM_CODE
                                     FROM MEMBER_AUTH A
                                     WHERE A.MEM_AUTH = 'ROLE_PROJECT_LEADER'
                                       AND A.MEM_CODE = #{memCode})) as mem_name
             , MEM_CODE
             , PROJ_ID
        FROM PROJ_MEM
        WHERE MEM_CODE = #{memCode}
          AND prtpt_aprov_code = 'Y'
    </select>
</mapper>